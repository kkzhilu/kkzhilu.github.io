<!DOCTYPE html>
<html lang="zh-CN">





<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" type="image/png" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="一切都是有可能的，甚至那些不可能的也是.">
  <meta name="author" content="Kerwin">
  <meta name="keywords" content="AI;AIGC;Java;分布式;后端;高并发;设计模式;并发编程;数据库;人工智能;">
  <title>单测实践 - Kerwin&#39;s Blog</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    <link  rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.0.0/styles/github-gist.min.css" />
  

  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_yg9cfy8wd6.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_pjno9b9zyxs.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script  src="/js/utils.js" ></script>
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>SuperKerwin's Blog</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="view intro-2" id="background" parallax=true
         style="background: url('/img/article.jpg') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="container text-center white-text fadeInUp">
            <span class="h2" id="subtitle">
              
            </span>

            
              
  <div class="mt-3 post-meta">
    <i class="iconfont icon-date-fill" aria-hidden="true"></i>
    <time datetime="2023-03-03 22:27">
      2023年3月3日 晚上
    </time>
  </div>


<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      3.9k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      48
       分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5" id="board">
          <div class="post-content mx-auto" id="post">
            
            <article class="markdown-body">
              <h1 id="单测实践"><a href="#单测实践" class="headerlink" title="单测实践"></a>单测实践</h1><p>标签： #Share</p>
<h2 id="认知与误区"><a href="#认知与误区" class="headerlink" title="认知与误区"></a>认知与误区</h2><p>我之前以为的单测：</p>
<ul>
<li>基于整个Spring体系（测试Profile&#x2F;预发Profile）运行代码、连接实际的数据库、Redis、中间件</li>
<li>模拟实际数据，拿到对应的返回结果</li>
</ul>
<p>理论上来说，这样的思路也没问题，因为在实际单测的场景中确实有一部分代码需要实际与中间件交互，来排查问题、整合数据、或者干脆测试环境DeBug。</p>
<p>新的领域：单测不仅仅可以通过完全复刻环境的方式进行，也可以通过<code>模拟</code>来进行，其本质是修改字节码，让其返回我需要的数据，进而保障整个方法的运行，保障方法内部if else的覆盖。</p>
<h2 id="Jacoco-实践"><a href="#Jacoco-实践" class="headerlink" title="Jacoco 实践"></a>Jacoco 实践</h2><h1 id="接入方式"><a href="#接入方式" class="headerlink" title="接入方式"></a>接入方式</h1><p>以离线方式为例(方便后续使用Powermock对静态方法、构造方法进行mock)</p>
<h2 id="maven依赖"><a href="#maven依赖" class="headerlink" title="maven依赖"></a>maven依赖</h2><pre><code class="hljs apache"><span class="hljs-section">&lt;properties&gt;</span>
  <span class="hljs-section">&lt;jacoco.version&gt;</span><span class="hljs-attribute">0</span>.<span class="hljs-number">8</span>.<span class="hljs-number">2</span>&lt;/jacoco.version&gt;
<span class="hljs-section">&lt;/properties&gt;</span></code></pre>

<p>在最外层的pom中全局引入jacoco依赖：</p>
<pre><code class="hljs dust"><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span></span>
<span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span>
<span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.jacoco<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span>
<span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>org.jacoco.agent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span>
<span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">classifier</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">classifier</span>&gt;</span></span>
<span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$</span><span class="hljs-template-variable">&#123;jacoco.version&#125;</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span></span>
<span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span></span>
<span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span>
<span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span></span></code></pre>

<p>全局plugin</p>
<pre><code class="hljs dust"><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span></span>
<span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span></span>
<span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span>
<span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-surefire-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span>
<span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.22.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span></span>
<span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span></span>
<span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">systemPropertyVariables</span>&gt;</span></span>
<span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">jacoco-agent.destfile</span>&gt;</span>target/jacoco.exec<span class="hljs-tag">&lt;/<span class="hljs-name">jacoco-agent.destfile</span>&gt;</span></span>
<span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">systemPropertyVariables</span>&gt;</span></span>
<span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span></span>
<span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span></span>
<span class="language-xml">  <span class="hljs-comment">&lt;!-- 生成JaCoCo覆盖率数据插件 --&gt;</span></span>
<span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span></span>
<span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.jacoco<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span>
<span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jacoco-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span>
<span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$</span><span class="hljs-template-variable">&#123;jacoco.version&#125;</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span></span>
<span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">executions</span>&gt;</span></span>
<span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span></span>
<span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>default-instrument<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span></span>
<span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span></span>
<span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>instrument<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span></span>
<span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span></span>
<span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span></span>
<span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span></span>
<span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>default-restore-instrumented-classes<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span></span>
<span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">phase</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">phase</span>&gt;</span></span>
<span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span></span>
<span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>restore-instrumented-classes<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span></span>
<span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span></span>
<span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span></span>
<span class="language-xml">      <span class="hljs-comment">&lt;!-- attached to Maven test phase --&gt;</span></span>
<span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span></span>
<span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>default-report<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span></span>
<span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">phase</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">phase</span>&gt;</span></span>
<span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span></span>
<span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>report<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span></span>
<span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span></span>
<span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span></span>
<span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">executions</span>&gt;</span></span>
<span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span></span>
<span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span></span></code></pre>



<h2 id="在IDEA中统计单元测试覆盖率"><a href="#在IDEA中统计单元测试覆盖率" class="headerlink" title="在IDEA中统计单元测试覆盖率"></a>在IDEA中统计单元测试覆盖率</h2><ol>
<li>在执行测试方法时，选择 <strong>Run with Converage</strong></li>
</ol>
<p><img src="/2023/03/03/%E5%8D%95%E6%B5%8B%E5%AE%9E%E8%B7%B5/link.png" srcset="/img/loading.gif" alt="img"></p>
<ol start="2">
<li>在执行完成后，会出现单元测试覆盖率统计界面</li>
</ol>
<p><img src="/2023/03/03/%E5%8D%95%E6%B5%8B%E5%AE%9E%E8%B7%B5/image-20230303140406664.png" srcset="/img/loading.gif" alt="image-20230303140406664"></p>
<h2 id="PowerMock-编码"><a href="#PowerMock-编码" class="headerlink" title="PowerMock 编码"></a>PowerMock 编码</h2><h3 id="maven接入"><a href="#maven接入" class="headerlink" title="maven接入"></a>maven接入</h3><pre><code class="hljs dust"><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span></span>
<span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">mockito.version</span>&gt;</span>3.12.4<span class="hljs-tag">&lt;/<span class="hljs-name">mockito.version</span>&gt;</span></span>
<span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">powermock.version</span>&gt;</span>2.0.2<span class="hljs-tag">&lt;/<span class="hljs-name">powermock.version</span>&gt;</span></span>
<span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span></span>
<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span>
<span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mockito<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span>
<span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mockito-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span>
<span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$</span><span class="hljs-template-variable">&#123;mockito.version&#125;</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span></span>
<span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span>
<span class="language-xml"></span>
<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span>
<span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.powermock<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span>
<span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>powermock-module-junit4<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span>
<span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$</span><span class="hljs-template-variable">&#123;powermock.version&#125;</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span></span>
<span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span></span>
<span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span>
<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span>
<span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.powermock<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span>
<span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>powermock-api-mockito2<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span>
<span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$</span><span class="hljs-template-variable">&#123;powermock.version&#125;</span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span></span>
<span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span></span>
<span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span></code></pre>

<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p><a target="_blank" rel="noopener" href="https://github.com/powermock/powermock/wiki/Mockito">https://github.com/powermock/powermock/wiki/Mockito</a></p>
<h3 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h3><pre><code class="hljs java"><span class="hljs-meta">@RunWith(MockitoJUnitRunner.class)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderServiceImplTest</span> &#123;

    <span class="hljs-meta">@Mock</span>
    <span class="hljs-keyword">private</span> OrderQueryServiceRpc mockOrderQueryServiceRpc;

    <span class="hljs-meta">@InjectMocks</span>
    <span class="hljs-keyword">private</span> OrderServiceImpl orderServiceImplUnderTest;

    <span class="hljs-meta">@Test</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testGetOrderInfoByOrderId4OrderSystemCancel</span> <span class="hljs-params">()</span> &#123;
        <span class="hljs-comment">// Setup</span>
        <span class="hljs-comment">// Configure OrderQueryServiceRpc.getOrderByOrderId(...).</span>
        <span class="hljs-keyword">final</span> <span class="hljs-type">OrderDTO</span> <span class="hljs-variable">orderDTO</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderDTO</span>();
        orderDTO.setOrderId(<span class="hljs-number">0L</span>);
        orderDTO.setSrcOrderId(<span class="hljs-string">&quot;srcOrderId&quot;</span>);
        orderDTO.setSrcPlatId(<span class="hljs-number">0</span>);
        orderDTO.setSrcOrderType(<span class="hljs-number">0</span>);
        orderDTO.setSrcInnerType(<span class="hljs-number">0</span>);
        orderDTO.setSrcInnerOrderId(<span class="hljs-number">0L</span>);
        orderDTO.setOrderType(<span class="hljs-number">0</span>);
        orderDTO.setOrderStatus(<span class="hljs-number">0</span>);
        orderDTO.setOrderStatusTime(<span class="hljs-keyword">new</span> <span class="hljs-title class_">GregorianCalendar</span>(<span class="hljs-number">2020</span>, Calendar.JANUARY, <span class="hljs-number">1</span>).getTime());
        orderDTO.setOrderStartTime(<span class="hljs-keyword">new</span> <span class="hljs-title class_">GregorianCalendar</span>(<span class="hljs-number">2020</span>, Calendar.JANUARY, <span class="hljs-number">1</span>).getTime());
        <span class="hljs-keyword">final</span> ServiceResponse&lt;OrderDTO&gt; orderDTOServiceResponse = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServiceResponse</span>&lt;&gt;(orderDTO);
        when(mockOrderQueryServiceRpc.getOrderByOrderId(eq(<span class="hljs-number">0L</span>), any(String[].class))).thenReturn(orderDTOServiceResponse);

        <span class="hljs-comment">// Run the test</span>
        <span class="hljs-keyword">final</span> List&lt;SystemCancelOrderDto&gt; result = orderServiceImplUnderTest.getOrderInfoByOrderId4OrderSystemCancel(<span class="hljs-number">0L</span>);

        <span class="hljs-comment">// Verify the results</span>
    &#125;
&#125;</code></pre>



<h3 id="插件-快速自动化"><a href="#插件-快速自动化" class="headerlink" title="插件 快速自动化"></a>插件 快速自动化</h3><p>Squaretest</p>
<h3 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h3><p><strong>JUnit5</strong> 要引入 <strong>mockito-junit-jupiter</strong> 包，并使用 <strong>@ExtendWith</strong> 注解来引入</p>
<pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- mockito for junit5 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mockito<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mockito-junit-jupiter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.23.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>







<h1 id="单元测试准则"><a href="#单元测试准则" class="headerlink" title="单元测试准则"></a>单元测试准则</h1><h3 id="1-保持单元测试小巧-快速"><a href="#1-保持单元测试小巧-快速" class="headerlink" title="1. 保持单元测试小巧, 快速"></a>1. 保持单元测试小巧, 快速</h3><p>理论上, 任何代码提交前都应该完整跑一遍所有测试套件. 保持测试代码执行迅捷能够缩短迭代开发周期.</p>
<h3 id="2-单元测试应该是全自动且无交互"><a href="#2-单元测试应该是全自动且无交互" class="headerlink" title="2. 单元测试应该是全自动且无交互"></a>2. 单元测试应该是全自动且无交互</h3><p>测试套件通常是定期执行的, 执行过程必须完全自动化才有意义. 需要人工检查输出结果的测试不是一个好的单元测试.</p>
<h3 id="3-让单元测试很容易跑起来"><a href="#3-让单元测试很容易跑起来" class="headerlink" title="3. 让单元测试很容易跑起来"></a>3. 让单元测试很容易跑起来</h3><p>对开发环境进行配置, 最好是敲条命令或是点个按钮就能把单个测试用例或测试套件跑起来.</p>
<h3 id="4-对测试进行评估"><a href="#4-对测试进行评估" class="headerlink" title="4. 对测试进行评估"></a>4. 对测试进行评估</h3><p>对执行的测试进行覆盖率分析, 得到精确的代码执行覆盖率, 并调查哪些代码未被执行.</p>
<h3 id="5-立即修正失败的测试"><a href="#5-立即修正失败的测试" class="headerlink" title="5. 立即修正失败的测试"></a>5. 立即修正失败的测试</h3><p>每个开发人员在提交前都应该保证新的测试用例执行成功, 当有代码提交时, 现有测试用例也都能跑通.</p>
<p>如果一个定期执行的测试用例执行失败, 整个团队应该放下手上的工作优先解决这个问题.</p>
<h3 id="6-把测试维持在单元级别"><a href="#6-把测试维持在单元级别" class="headerlink" title="6. 把测试维持在单元级别"></a>6. 把测试维持在单元级别</h3><p>单元测试即类 (Class) 的测试. 一个 “测试类” 应该只对应于一个 “被测类”, 并且 “被测类” 的行为应该被隔离测试. 必须谨慎避免使用单元测试框架来测试整个程序的工作流, 这样的测试既低效又难维护. 工作流测试 (译注: 指跨模块&#x2F;类的数据流测试) 有它自己的地盘, 但它绝不是单元测试, 必须单独建立和执行.</p>
<h3 id="7-由简入繁"><a href="#7-由简入繁" class="headerlink" title="7. 由简入繁"></a>7. 由简入繁</h3><p>最简单的测试也远远胜过完全没有测试. 一个简单的 “测试类” 会促使建立 “被测类” 基本的测试骨架, 可以对构建环境, 单元测试环境, 执行环境以及覆盖率分析工具等有效性进行检查, 同时也可以证明 “被测类” 能够被整合和调用.</p>
<p>下面便是单元测试版的<em>Hello, world!</em>:</p>
<pre><code class="hljs reasonml">void test<span class="hljs-constructor">DefaultConstruction()</span>
&#123;
   Foo foo = <span class="hljs-keyword">new</span> <span class="hljs-constructor">Foo()</span>;
   <span class="hljs-keyword">assert</span><span class="hljs-constructor">NotNull(<span class="hljs-params">foo</span>)</span>;
&#125;</code></pre>

<h3 id="8-保持测试的独立性"><a href="#8-保持测试的独立性" class="headerlink" title="8. 保持测试的独立性"></a>8. 保持测试的独立性</h3><p>为了保证测试稳定可靠且便于维护, 测试用例之间决不能有相互依赖, 也不能依赖执行的先后次序.</p>
<h3 id="9-Keep-tests-close-to-the-class-being-tested"><a href="#9-Keep-tests-close-to-the-class-being-tested" class="headerlink" title="9. Keep tests close to the class being tested"></a>9. Keep tests close to the class being tested</h3><p>[译注: 有意翻译该规则, 个人认为本条规则值得商榷, 大部分 C++, Objective-C和 Python 库均把测试代码从功能代码目录中独立出来, 通常是创建一个和<code>src</code>目录同级的<code>tests</code>目录, 被测模块&#x2F;类名之前也常常<em>不加</em><code>Test</code>前缀. 这么做保证功能代码和测试代码隔离, 目录结构清晰, 并且发布源码的时候更容易排除测试用例.]</p>
<p>If the class to test is Foo the test class should be called FooTest (not TestFoo) and kept in the same package (directory) as Foo. Keeping test classes in separate directory trees makes them harder to access and maintain.</p>
<p>Make sure the build environment is configured so that the test classes doesn’t make its way into production libraries or executables.</p>
<h3 id="10-合理的命名测试用例"><a href="#10-合理的命名测试用例" class="headerlink" title="10. 合理的命名测试用例"></a>10. 合理的命名测试用例</h3><p>确保每个方法只测试 “被测类” 的一个明确特性, 并相应的命名测试方法. 典型的命名俗定是<code>test[what]</code>, 比如<code>testSaveAs()</code>,<code>testAddListener()</code>,<code>testDeleteProperty()</code>等.</p>
<h3 id="11-只测公有接口"><a href="#11-只测公有接口" class="headerlink" title="11. 只测公有接口"></a>11. 只测公有接口</h3><p>单元测试可以被定义为<em>通过类的公有 API 对类进行测试</em>. 一些测试工具允许测试一个类的私有成员, 但这种做法应该避免, 它让测试变得繁琐而且更难维护. 如果有私有成员确实需要进行直接测试, 可以考虑把它重构到工具类的公有方法中. 但要注意这么做是为了改善设计, 而不是帮助测试.</p>
<h3 id="12-看成是黑盒"><a href="#12-看成是黑盒" class="headerlink" title="12. 看成是黑盒"></a>12. 看成是黑盒</h3><p>站在第三方使用者的角度, 测试一个类是否满足规定的需求. 并设法让它出问题.</p>
<h3 id="13-看成是白盒"><a href="#13-看成是白盒" class="headerlink" title="13. 看成是白盒"></a>13. 看成是白盒</h3><p>毕竟被测试类是程序员自写自测的, 应该在最复杂的逻辑部分多花些精力测试.</p>
<h3 id="14-芝麻函数也要测试"><a href="#14-芝麻函数也要测试" class="headerlink" title="14. 芝麻函数也要测试"></a>14. 芝麻函数也要测试</h3><p>通常建议所有重要的函数都应该被测试到, 一些芝麻方法比如简单的<code>setter</code>和<code>getter</code>都可以忽略. 但是仍然有充分的理由支持测试芝麻函数:</p>
<ul>
<li><em>芝麻</em>很难定义. 对于不同的人有不同的理解.</li>
<li>从黑盒测试的观点看, 是无法知道哪些代码是芝麻级别的.</li>
<li>即便是再芝麻的函数, 也可能包含错误, 通常是 “复制粘贴” 代码的后果:</li>
</ul>
<pre><code class="hljs csharp"><span class="hljs-keyword">private</span> <span class="hljs-built_in">double</span> weight_;
<span class="hljs-keyword">private</span> <span class="hljs-built_in">double</span> x_, y_;

<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setWeight</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> weight</span>)</span>
&#123;
  weight = weight_;  <span class="hljs-comment">// error</span>
&#125;

<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">double</span> <span class="hljs-title">getX</span>()</span>
&#123;
  <span class="hljs-keyword">return</span> x_;
&#125;

<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">double</span> <span class="hljs-title">getY</span>()</span>
&#123;
  <span class="hljs-keyword">return</span> x_;  <span class="hljs-comment">// error</span>
&#125;</code></pre>

<p>因此建议测试所有方法. 毕竟芝麻用例也容易测试.</p>
<h3 id="15-先关注执行覆盖率"><a href="#15-先关注执行覆盖率" class="headerlink" title="15. 先关注执行覆盖率"></a><a target="_blank" rel="noopener" href="https://github.com/yangyubo/zh-unit-testing-guidelines#15-%E5%85%88%E5%85%B3%E6%B3%A8%E6%89%A7%E8%A1%8C%E8%A6%86%E7%9B%96%E7%8E%87">1</a>5. 先关注执行覆盖率</h3><p>区别对待<em>执行覆盖率</em>和<em>实际测试覆盖率</em>. 测试的最初目标应该是确保较高的执行覆盖率. 这样能保证代码在<em>少量</em>参数值输入时能执行成功. 一旦执行覆盖率就绪, 就应该开始改进测试覆盖率了. 注意, 实际的测试覆盖率很难衡量 (而且往往趋近于 0%).</p>
<p>思考以下公有方法:</p>
<pre><code class="hljs arduino"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">setLength</span><span class="hljs-params">(<span class="hljs-type">double</span> length)</span></span>;</code></pre>

<p>调用<code>setLength(1.0)</code>你可能会得到 100% 的执行覆盖率. 但要达到 100% 的实际测试覆盖率, 有多少个<code>double</code>浮点数这个方法就必须被调用多少次, 并且要一一验证行为的正确性. 这无疑是不可能的任务.</p>
<h3 id="16-覆盖边界值"><a href="#16-覆盖边界值" class="headerlink" title="16. 覆盖边界值"></a>16. 覆盖边界值</h3><p>确保参数边界值均被覆盖. 对于数字, 测试负数, 0, 正数, 最小值, 最大值, NaN (非数字), 无穷大等. 对于字符串, 测试空字符串, 单字符, 非 ASCII 字符串, 多字节字符串等. 对于集合类型, 测试空, 1, 第一个, 最后一个等. 对于日期, 测试 1月1号, 2月29号, 12月31号等. 被测试的类本身也会暗示一些特定情况下的边界值. 要点是尽可能彻底的测试这些边界值, 因为它们都是主要 “疑犯”.</p>
<h3 id="17-提供一个随机值生成器"><a href="#17-提供一个随机值生成器" class="headerlink" title="17. 提供一个随机值生成器"></a>17. 提供一个随机值生成器</h3><p>当边界值都覆盖了, 另一个能进一步改善测试覆盖率的简单方法就是生成随机参数, 这样每次执行测试都会有不同的输入.</p>
<p>想要做到这点, 需要提供一个用来生成基本类型 (如: 浮点数, 整型, 字符串, 日期等) 随机值的工具类. 生成器应该覆盖各种类型的所有取值范围.</p>
<p>如果测试时间比较短, 可以考虑再裹上一层循环, 覆盖尽可能多的输入组合. 下面的例子是验证两次转换 little endian 和 big endian 字节序后是否返回原值. 由于测试过程很快, 可以让它跑上个一百万次.</p>
<pre><code class="hljs reasonml">void test<span class="hljs-constructor">ByteSwapper()</span>
&#123;
  <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000000</span>; i++) &#123;
    double v0 = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Random</span>.</span></span>get<span class="hljs-constructor">Double()</span>;
    double v1 = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ByteSwapper</span>.</span></span>swap(v0);
    double v2 = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ByteSwapper</span>.</span></span>swap(v1);
    <span class="hljs-keyword">assert</span><span class="hljs-constructor">Equals(<span class="hljs-params">v0</span>, <span class="hljs-params">v2</span>)</span>;
  &#125;
&#125;</code></pre>

<h3 id="18-每个特性只测一次"><a href="#18-每个特性只测一次" class="headerlink" title="18. 每个特性只测一次"></a>18. 每个特性只测一次</h3><p>在测试模式下, 有时会情不自禁的滥用断言. 这种做法会导致维护更困难, 需要极力避免. 仅对测试方法名指示的特性进行明确测试.</p>
<p>因为对于一般性代码而言, 保证测试代码尽可能少是一个重要目标.</p>
<h3 id="19-使用显式断言"><a href="#19-使用显式断言" class="headerlink" title="19. 使用显式断言"></a>19. 使用显式断言</h3><p>应该总是优先使用<code>assertEquals(a, b)</code>而不是<code>assertTrue(a == b)</code>, 因为前者会给出更有意义的测试失败信息. 在事先不确定输入值的情况下, 这条规则尤为重要, 比如之前使用随机参数值组合的例子.</p>
<h3 id="20-提供反向测试"><a href="#20-提供反向测试" class="headerlink" title="20. 提供反向测试"></a>20. 提供反向测试</h3><p>反向测试是指刻意编写问题代码, 来验证鲁棒性和能否正确的处理错误.</p>
<p>假设如下方法的参数如果传进去的是负数, 会立马抛出异常:</p>
<pre><code class="hljs java"><span class="hljs-keyword">void</span> <span class="hljs-title function_">setLength</span><span class="hljs-params">(<span class="hljs-type">double</span> length)</span> <span class="hljs-keyword">throws</span> IllegalArgumentExcepti</code></pre>

<p>可以用下面的方法来测试这个特例是否被正确处理:</p>
<pre><code class="hljs scss">try &#123;
  <span class="hljs-built_in">setLength</span>(-<span class="hljs-number">1.0</span>);
  <span class="hljs-built_in">fail</span>();  <span class="hljs-comment">// If we get here, something went wrong</span>
&#125;
catch (IllegalArgumentException exception) &#123;
  <span class="hljs-comment">// If we get here, all is fine</span>
&#125;</code></pre>

<h3 id="21-代码设计时谨记测试"><a href="#21-代码设计时谨记测试" class="headerlink" title="21. 代码设计时谨记测试"></a>21. 代码设计时谨记测试</h3><p>编写和维护单元测试的代价是很高的, 减少代码中的公有接口和循环复杂度是降低成本, 使高覆盖率测试代码更易于编写和维护的有效方法.</p>
<p>一些建议:</p>
<blockquote>
<ul>
<li>使类成员常量化, 在构造函数中进行初始化. 减少<code>setter</code>方法的数量.</li>
<li>限制过度使用继承和公有虚函数.</li>
<li>通过使用友元类 (C++) 或包作用域 (Java) 来减少公有接口.</li>
<li>避免不必要的逻辑分支.</li>
<li>在逻辑分支中编写尽可能少的代码.</li>
<li>在公有和私有接口中尽量多用异常和断言验证参数参数的有效性.</li>
<li>限制使用快捷函数. 对于黑箱而言, 所有方法都必须一视同仁的进行测试. 思考以下简短的例子:</li>
</ul>
<pre><code class="hljs processing"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-built_in">scale</span>(<span class="hljs-type">double</span> x0, <span class="hljs-type">double</span> y0, <span class="hljs-type">double</span> scaleFactor)
&#123;
  <span class="hljs-comment">// scaling logic</span>
&#125;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-built_in">scale</span>(<span class="hljs-type">double</span> x0, <span class="hljs-type">double</span> y0)
&#123;
  <span class="hljs-built_in">scale</span>(x0, y0, <span class="hljs-number">1.0</span>);
&#125;</code></pre>

<ul>
<li>删除后者可以简化测试, 但用户代码的工作量也将略微增加.</li>
</ul>
</blockquote>
<h3 id="22-不要访问预设的外部资源"><a href="#22-不要访问预设的外部资源" class="headerlink" title="22. 不要访问预设的外部资源"></a>22. 不要访问预设的外部资源</h3><p>单元测试代码不应该假定外部的执行环境, 以便在任何时候&#x2F;任何地方都能执行. 为了向测试提供必需的资源, 这些资源应该由测试本身提供.</p>
<p>比如一个解析某类型文件的类, 可以把文件内容嵌入到测试代码里, 在测试的时候写入到临时文件, 测试结束再删除, 而不是从预定的地址直接读取.</p>
<h3 id="23-权衡测试成本"><a href="#23-权衡测试成本" class="headerlink" title="23. 权衡测试成本"></a>23. 权衡测试成本</h3><p>不写单元测试的代价很高, 但是写单元测试的代价同样很高. 要在这两者之间做适当的权衡, 如果用执行覆盖率来衡量, 业界标准通常在 80% 左右.</p>
<p>很典型的, 读写外部资源的错误处理和异常处理就很难达到百分百的执行覆盖率. 模拟数据库在事务处理到一半时发生故障并不是办不到, 但相对于进行大范围的代码审查, 代价可能太大了.</p>
<h3 id="24-安排测试优先次序"><a href="#24-安排测试优先次序" class="headerlink" title="24. 安排测试优先次序"></a>24. 安排测试优先次序</h3><p>单元测试是典型的自底向上过程, 如果没有足够的资源测试一个系统的所有模块, 就应该先把重点放在较底层的模块.</p>
<h3 id="25-测试代码要考虑错误处理"><a href="#25-测试代码要考虑错误处理" class="headerlink" title="25. 测试代码要考虑错误处理"></a>25. 测试代码要考虑错误处理</h3><p>考虑下面的这个例子:</p>
<pre><code class="hljs reasonml">Handle handle = manager.get<span class="hljs-constructor">Handle()</span>;
<span class="hljs-keyword">assert</span><span class="hljs-constructor">NotNull(<span class="hljs-params">handle</span>)</span>;

String handleName = handle.get<span class="hljs-constructor">Name()</span>;
<span class="hljs-keyword">assert</span><span class="hljs-constructor">Equals(<span class="hljs-params">handleName</span>, <span class="hljs-string">&quot;handle-01&quot;</span>)</span>;</code></pre>

<p>如果第一个断言失败, 后续语句会导致代码崩溃, 剩下的测试都无法执行. 任何时候都要为测试失败做好准备, 避免单个失败的测试项中断整个测试套件的执行. 上面的例子可以重写成:</p>
<pre><code class="hljs lasso"><span class="hljs-keyword">Handle</span> <span class="hljs-keyword">handle</span> = manager.getHandle();
assertNotNull(<span class="hljs-keyword">handle</span>);
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">handle</span> == <span class="hljs-built_in">null</span>) <span class="hljs-keyword">return</span>;

<span class="hljs-built_in">String</span> handleName = <span class="hljs-keyword">handle</span>.getName();
assertEquals(handleName, <span class="hljs-string">&quot;handle-01&quot;</span>);</code></pre>

<h3 id="26-写测试用例重现-bug"><a href="#26-写测试用例重现-bug" class="headerlink" title="26. 写测试用例重现 bug"></a>26. 写测试用例重现 bug</h3><p>每上报一个 bug, 都要写一个测试用例来重现这个 bug (即无法通过测试), 并用它作为成功修正代码的检验标准.</p>
<h3 id="27-了解局限"><a href="#27-了解局限" class="headerlink" title="27. 了解局限"></a>27. 了解局限</h3><p><em>单元测试永远无法证明代码的正确性!!</em></p>
<p>一个跑失败的测试可能表明代码有错误, 但一个跑成功的测试什么也证明不了.</p>
<p>单元测试最有效的使用场合是在一个较低的层级验证并文档化需求, 以及<em>回归测试</em>: 开发或重构代码时，不会破坏已有功能的正确性.</p>

            </article>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/%E8%B4%A8%E9%87%8F%E4%BF%9D%E9%9A%9C%E7%AF%87/">质量保障篇</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/%E5%8D%95%E6%B5%8B%E5%AE%9E%E8%B7%B5/">单测实践</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！</p>
              
              
                <div class="post-prevnext row">
                  <div class="post-prev col-6">
                    
                    
                      <a href="/2023/05/18/Java%E8%BF%9C%E7%A8%8BDeBug%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Java远程DeBug解决方案</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </div>
                  <div class="post-next col-6">
                    
                    
                      <a href="/2023/02/06/CSS%E7%BD%91%E7%AB%99%E5%8F%98%E7%81%B0%E4%BB%A3%E7%A0%81/">
                        <span class="hidden-mobile">CSS网站变灰代码</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </div>
                </div>
              
            </div>

            
              <!-- Comments -->
              <div class="comments" id="comments">
                
                
  <div class="disqus" style="width:100%">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
      function loadDisqus() {
        var disqus_config = function () {
          this.page.url = 'http://example.com/2023/03/03/单测实践/';
          this.page.identifier = '/2023/03/03/单测实践/';
        };
        (function () {
          var d = document,
            s = d.createElement('script');
          s.src = '//' + '' + '.disqus.com/embed.js';
          s.setAttribute('data-timestamp', new Date());
          (d.head || d.body).appendChild(s);
        })();
      }
      createObserver(loadDisqus, 'disqus_thread');
    </script>
    <noscript>Please enable JavaScript to view the
      <a target="_blank" href="https://disqus.com/?ref_noscript" rel="nofollow noopener noopener">comments powered by Disqus.</a>
    </noscript>
  </div>


              </div>
            
          </div>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div id="tocbot"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    
  </main>

  
    <a id="scroll-top-button" href="#" role="button">
      <i class="iconfont icon-arrowup" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  

  

  <footer class="mt-5">
  <div class="text-center py-3">
    <div>
      <a href="https://juejin.cn/user/1275089220013336" target="_blank" rel="nofollow noopener"><span>掘金</span></a>
      <i class="iconfont icon-love"></i>
      <a href="https://github.com/kkzhilu" target="_blank" rel="nofollow noopener">
        <span>GitHub</span></a>
    

    

    
  </div>
</footer>

<!-- SCRIPTS -->
<script  src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/main.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/lazyload.js" ></script>
  



  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js" ></script>
  <script  src="/js/clipboard-use.js" ></script>







  <script  src="https://cdn.staticfile.org/tocbot/4.11.1/tocbot.min.js" ></script>
  <script>
    $(document).ready(function () {
      var boardCtn = $('#board-ctn');
      var boardTop = boardCtn.offset().top;

      tocbot.init({
        tocSelector: '#tocbot',
        contentSelector: 'article.markdown-body',
        headingSelector: 'h1,h2,h3,h4,h5,h6',
        linkClass: 'tocbot-link',
        activeLinkClass: 'tocbot-active-link',
        listClass: 'tocbot-list',
        isCollapsedClass: 'tocbot-is-collapsed',
        collapsibleClass: 'tocbot-is-collapsible',
        collapseDepth: 0,
        scrollSmooth: true,
        headingsOffset: -boardTop
      });
      if ($('.toc-list-item').length > 0) {
        $('#toc').css('visibility', 'visible');
      }
    });
  </script>



  <script  src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js" ></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "单测实践&nbsp;",
      ],
      cursorChar: "_",
      typeSpeed: 70,
      loop: false,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script  src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      searchFunc(path, 'local-search-input', 'local-search-result');
      this.onclick = null
    }
  </script>



  <script  src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />

  <script>
    $('#post img:not(.no-zoom img, img[no-zoom]), img[zoom]').each(
      function () {
        var element = document.createElement('a');
        $(element).attr('data-fancybox', 'images');
        $(element).attr('href', $(this).attr('src'));
        $(this).wrap(element);
      }
    );
  </script>




















</body>
</html>
